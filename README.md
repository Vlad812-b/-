# Система голосования - Две версии приложения

Проект содержит две версии приложения для голосования с базой данных и вычислительным экспериментом для сравнения производительности.

## Структура проекта

```
.
├── version1_flask/          # Версия 1: Flask приложение
│   ├── app.py               # Основной файл приложения
│   ├── requirements.txt     # Зависимости
│   ├── templates/           # HTML шаблоны
│   └── voting.db           # База данных SQLite (создается автоматически)
│
├── version2_django/         # Версия 2: Django приложение
│   ├── manage.py            # Django управляющий скрипт
│   ├── requirements.txt     # Зависимости
│   ├── voting_system/       # Настройки проекта
│   ├── polls/               # Приложение голосования
│   ├── templates/           # HTML шаблоны
│   └── db.sqlite3           # База данных SQLite (создается автоматически)
│
├── benchmark_experiment.py  # Скрипт для вычислительного эксперимента
└── README.md                # Этот файл
```

## Функциональность

### Роли пользователей

1. **Админ (admin)**
   - Полный доступ ко всем функциям
   - Может создавать голосования
   - Может управлять ролями пользователей
   - Может управлять всеми голосованиями

2. **Зам. админа (deputy_admin)**
   - Может создавать голосования
   - Может управлять голосованиями
   - НЕ может изменять роли пользователей

3. **Пользователь (user)**
   - Может только голосовать в активных голосованиях
   - Требуется авторизация для голосования

### Основные функции

- ✅ Регистрация и авторизация пользователей
- ✅ Система ролей (админ, зам. админа, пользователь)
- ✅ Создание голосований (только админ и зам. админа)
- ✅ Голосование (только авторизованные пользователи)
- ✅ Просмотр результатов голосования
- ✅ Управление пользователями (только админ)
- ✅ Управление голосованиями (админ и зам. админа)

## Установка и запуск

### Версия 1: Flask

1. Перейдите в директорию версии 1:
```bash
cd version1_flask
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите приложение:
```bash
python app.py
```

4. Откройте в браузере: http://localhost:5000

**Учетные данные администратора по умолчанию:**
- Имя пользователя: `admin`
- Пароль: `admin123`

### Версия 2: Django

1. Перейдите в директорию версии 2:
```bash
cd version2_django
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Выполните миграции:
```bash
python manage.py makemigrations
python manage.py migrate
```

4. Создайте суперпользователя (администратора):
```bash
python manage.py createsuperuser
```

5. Запустите сервер разработки:
```bash
python manage.py runserver
```

6. Откройте в браузере: http://localhost:8000

## Вычислительный эксперимент

Для сравнения производительности двух версий приложения запустите скрипт эксперимента:

```bash
python benchmark_experiment.py
```

Эксперимент измеряет:
- Производительность операций с базой данных (INSERT, SELECT, UPDATE, DELETE)
- Производительность сложных SQL запросов (JOIN, AGGREGATE, SUBQUERY)
- Сравнивает результаты между Flask и Django версиями

Результаты сохраняются в JSON файл с временной меткой.

## Использование

### Регистрация нового пользователя

1. Перейдите на страницу регистрации
2. Заполните форму (имя пользователя, email, пароль)
3. После регистрации войдите в систему

### Создание голосования (только для админа и зам. админа)

1. Войдите в систему с правами админа или зам. админа
2. Нажмите "Создать голосование"
3. Заполните форму:
   - Название голосования
   - Описание (опционально)
   - Варианты ответа (каждый с новой строки, минимум 2)
4. Нажмите "Создать голосование"

### Голосование

1. Войдите в систему (требуется авторизация)
2. Выберите активное голосование
3. Выберите вариант ответа
4. Нажмите "Проголосовать"
5. После голосования вы увидите результаты

### Управление пользователями (только для админа)

1. Войдите как администратор
2. Перейдите в "Управление пользователями"
3. Измените роль пользователя через выпадающий список
4. Роль изменится автоматически

### Управление голосованиями (для админа и зам. админа)

1. Войдите с соответствующими правами
2. Перейдите в "Все голосования"
3. Используйте кнопку "Закрыть/Открыть" для управления статусом голосования

## Технические детали

### Версия 1 (Flask)
- **Фреймворк**: Flask 3.0.0
- **ORM**: SQLAlchemy (Flask-SQLAlchemy)
- **База данных**: SQLite
- **Аутентификация**: Flask-Login
- **Хеширование паролей**: Werkzeug

### Версия 2 (Django)
- **Фреймворк**: Django 5.0.1
- **ORM**: Django ORM
- **База данных**: SQLite
- **Аутентификация**: Django Auth
- **Хеширование паролей**: Django Password Hashers

## Модели данных

### User / UserProfile
- `id` - уникальный идентификатор
- `username` - имя пользователя
- `email` - email адрес
- `password_hash` - хеш пароля
- `role` - роль (admin, deputy_admin, user)
- `created_at` - дата регистрации

### Poll
- `id` - уникальный идентификатор
- `title` - название голосования
- `description` - описание
- `created_by` - создатель (связь с User)
- `created_at` - дата создания
- `is_active` - статус активности

### PollOption
- `id` - уникальный идентификатор
- `poll_id` - связь с голосованием
- `text` - текст варианта ответа
- `vote_count` - количество голосов

### Vote
- `id` - уникальный идентификатор
- `poll_id` - связь с голосованием
- `user_id` - связь с пользователем
- `option_id` - выбранный вариант
- `voted_at` - время голосования

## Безопасность

- Пароли хранятся в виде хешей (не в открытом виде)
- CSRF защита (в Django встроена, в Flask через формы)
- Проверка прав доступа на уровне представлений
- Защита от повторного голосования (один пользователь - один голос)

## Примечания

- Обе версии используют SQLite для простоты развертывания
- Для продакшена рекомендуется использовать PostgreSQL или MySQL
- Секретные ключи в настройках должны быть изменены
- Обе версии создают администратора по умолчанию при первом запуске (только Flask версия)

## Лицензия

Проект создан в учебных целях.

